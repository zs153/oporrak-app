/*! oporrak 2023-05-14 */
import webServer from"./services/web-server";import database from"./services/database";import{dbPool}from"./config/settings";const defaultThreadPoolSize=4;async function startup(){console.log("Starting application");try{console.log("Initializing database module"),await database.initialize()}catch(o){console.error(o),process.exit(1)}try{console.log("Initializing web server module"),await webServer.initialize()}catch(o){console.error(o),process.exit(1)}}async function shutdown(o){let e=o;console.log("Shutting down application");try{console.log("Closing web server module"),await webServer.close()}catch(o){console.error(o),e=e||o}try{console.log("Closing database module"),await database.close()}catch(o){console.error(o),e=e||o}console.log("Exiting process"),e?process.exit(1):process.exit(0)}process.env.UV_THREADPOOL_SIZE=dbPool.poolMax+defaultThreadPoolSize,startup(),process.once("SIGTERM",()=>{console.log("Received SIGTERM"),shutdown()}),process.once("SIGINT",()=>{console.log("Received SIGINT"),shutdown()}),process.once("uncaughtException",o=>{console.log("Uncaught exception"),console.error(o),shutdown(o)});