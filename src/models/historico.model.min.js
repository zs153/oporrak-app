/*! oporrak 2023-05-17 */
import{simpleExecute}from"../services/database.js";const baseQuery=`SELECT *
FROM historicos
`,updateSql=`BEGIN OPORRAK_PKG.UPDATEHISTORICO(
  :idusua,
  :nomusu,
  :ofiusu, 
  :rolusu, 
  :emausu, 
  :perusu, 
  :telusu, 
  :usumov, 
  :tipmov
); END;
`,activarSql=`BEGIN OPORRAK_PKG.ACTIVARHISTORICO(
  :idusua,
  :usumov,
  :tipmov
); END;
`,find=async u=>{let t=baseQuery;u.IDUSUA&&(t+="WHERE idusua = :idusua");u=await simpleExecute(t,u);return u?{stat:u.rows.length,data:u.rows}:{stat:0,data:[]}},findAll=async u=>{let t="";var s={limit:u.limit,part:u.part},u=(t="next"===u.direction?(s.nomusu=""===u.cursor.next?null:u.cursor.next,`WITH datos AS (
      SELECT idusua, nomusu, userid FROM historicos
      WHERE
        nomusu LIKE '%' || :part || '%' OR
        :part IS NULL
    )
    SELECT * FROM datos
    WHERE nomusu > :nomusu OR :nomusu IS NULL
    ORDER BY nomusu ASC
    FETCH NEXT :limit ROWS ONLY
    `):(s.nomusu=""===u.cursor.prev?null:u.cursor.prev,`WITH datos AS (
      SELECT idusua, nomusu, userid FROM historicos
      WHERE
        nomusu LIKE '%' || :part || '%' OR
        :part IS NULL
    )
    SELECT * FROM datos
    WHERE nomusu < CONVERT(:nomusu, 'US7ASCII') OR :nomusu IS NULL
    ORDER BY nomusu DESC
    FETCH NEXT :limit ROWS ONLY
    `),await simpleExecute(t,s));return u?{stat:u.rows.length,data:u.rows}:{stat:0,data:[]}},update=async u=>{return await simpleExecute(updateSql,u)?{stat:1,data:u}:{stat:null,data:[]}},activar=async u=>{return await simpleExecute(activarSql,u)?{stat:1,data:u}:{stat:null,data:[]}};export{find,findAll,update,activar};