/*! oporrak 2023-05-14 */
import{BIND_OUT,NUMBER}from"oracledb";import{simpleExecute}from"../services/database.js";const baseQuery=`SELECT *
FROM oficinas oo
`,insertSql=`BEGIN OPORRAK_PKG.INSERTOFICINA(
  :desofi, 
  :codofi,
  :usumov,
  :tipmov,
  :idofic
); END;
`,updateSql=`BEGIN OPORRAK_PKG.UPDATEOFICINA(
  :idofic,
  :desofi, 
  :codofi,
  :usumov,
  :tipmov
); END;
`,removeSql=`BEGIN OPORRAK_PKG.DELETEOFICINA(
  :idofic,
  :usumov,
  :tipmov 
); END;
`,find=async t=>{let i=baseQuery;t.IDOFIC&&(i+="WHERE idofic = :idofic"),t.CODOFI&&(i+="WHERE codofi = :codofi");t=await simpleExecute(i,t);return t?{stat:t.rows.length,data:t.rows}:{stat:0,data:[]}},findAll=async t=>{let i="";var a={limit:t.limit,part:t.part},t=(i="next"===t.direction?(a.idofic=t.cursor.next,`WITH datos AS (
      SELECT * FROM oficinas
      WHERE
        desofi LIKE '%' || :part || '%' OR
        :part IS NULL
    )
    SELECT * FROM datos
    WHERE idofic > :idofic
    ORDER BY idofic ASC
    FETCH NEXT :limit ROWS ONLY
    `):(a.idofic=t.cursor.prev,`WITH datos AS (
      SELECT * FROM oficinas
      WHERE
        desofi LIKE '%' || :part || '%' OR
        :part IS NULL
    )
    SELECT * FROM datos
    WHERE idofic < :idofic
    ORDER BY idofic DESC
    FETCH NEXT :limit ROWS ONLY
    `),await simpleExecute(i,a));return t?{stat:t.rows.length,data:t.rows}:{stat:0,data:[]}},insert=async t=>{t.IDOFIC={dir:BIND_OUT,type:NUMBER};var i=await simpleExecute(insertSql,t);return i?(t.IDOFIC=i.outBinds.IDOFIC,{stat:1,data:t}):{stat:0,data:[]}},update=async t=>{return await simpleExecute(updateSql,t)?{stat:1,data:t}:{stat:0,data:[]}},remove=async t=>{return await simpleExecute(removeSql,t)?{stat:1,data:t}:{stat:0,data:[]}};export{find,findAll,insert,update,remove};