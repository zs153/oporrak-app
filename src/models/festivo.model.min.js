/*! oporrak 2023-05-17 */
import{BIND_OUT,NUMBER}from"oracledb";import{simpleExecute}from"../services/database.js";const festivosSql=`SELECT 
  idfest,
  TO_CHAR(fecfes, 'YYYY-MM-DD') "FECFES",
  ofifes
FROM festivos
WHERE fecfes BETWEEN TO_DATE(:desde, 'YYYY-MM-DD') AND TO_DATE(:hasta, 'YYYY-MM-DD')
`,festivosOficinaSql=`SELECT 
  TO_CHAR(ff.fecfes, 'YYYY-MM-DD') "FECFES"
FROM festivos ff
WHERE (ff.ofifes = :ofifes OR ff.ofifes = 0) AND
  fecfes BETWEEN TO_DATE(:desde, 'YYYY-MM-DD') AND TO_DATE(:hasta, 'YYYY-MM-DD')
`,festivosLocalSql=`SELECT 
  ff.idfest,
  TO_CHAR(ff.fecfes, 'YYYY-MM-DD') "FECFES",
  ff.ofifes
FROM festivos ff
WHERE ff.ofifes > 0 AND
  ff.fecfes BETWEEN TO_DATE(:desde, 'YYYY-MM-DD') AND TO_DATE(:hasta, 'YYYY-MM-DD')
`,festivosOficinaLocalSql=`SELECT 
  ff.idfest,
  TO_CHAR(ff.fecfes, 'YYYY-MM-DD') "FECFES",
  ff.ofifes
FROM festivos ff
WHERE ff.ofifes = :ofifes
AND ff.fecfes BETWEEN TO_DATE(:desde, 'YYYY-MM-DD') AND TO_DATE(:hasta, 'YYYY-MM-DD')
`,insertSql=`BEGIN OPORRAK_PKG.INSERTFESTIVO(
  TO_DATE(:fecfes, 'YYYY-MM-DD'),
  :ofifes,
  :usumov,
  :tipmov,
  :idfest
); END;
`,removeSql=`BEGIN OPORRAK_PKG.DELETEFESTIVO(
  :idfest,
  :ofifes,
  :usumov,
  :tipmov
); END;
`,updateSql=`BEGIN OPORRAK_PKG.UPDATEFESTIVOS(
  :arrfes,
  :usumov,
  :tipmov,
  :tipmoz
); END;
`,find=async e=>{let s=festivosSql;e.OFIFES&&(s+="AND ofifes = :ofifes");e=await simpleExecute(s,e);return e?{stat:e.rows.length,data:e.rows}:{stat:0,data:[]}},insert=async e=>{e.IDFEST={dir:BIND_OUT,type:NUMBER};var s=await simpleExecute(insertSql,e);return s?(e.IDFEST=s.outBinds.IDFEST,{stat:1,data:e}):{stat:0,data:[]}},update=async e=>{return await simpleExecute(updateSql,e)?{stat:1,data:e}:{stat:0,data:[]}},remove=async e=>{return await simpleExecute(removeSql,e)?{stat:1,data:e}:{stat:0,data:[]}},festivosOficina=async e=>{var s=festivosOficinaSql,s=await simpleExecute(s,e);return s?{stat:s.rows.length,data:s.rows}:{stat:0,data:[]}},festivosLocal=async e=>{let s=festivosLocalSql;e.OFIFES&&(s+="AND ff.ofifes = :ofifes");e=await simpleExecute(s,e);return e?{stat:e.rows.length,data:e.rows}:{stat:0,data:[]}},festivosOficinaLocal=async e=>{var s=festivosOficinaLocalSql,s=await simpleExecute(s,e);return s?{stat:s.rows.length,data:s.rows}:{stat:0,data:[]}};export{find,insert,update,remove,festivosOficina,festivosLocal,festivosOficinaLocal};