/*! oporrak 2023-05-18 */
const desfec=document.getElementById("desfec"),cbofor=document.getElementById("cbofor"),setSuccess=e=>{var t=e.parentElement;t.querySelector(".invalid-feedback").innerText="",t.classList.add("is-valid"),e.classList.remove("is-invalid")},setError=(e,t)=>{var a=e.parentElement;a.querySelector(".invalid-feedback").innerText=t,e.classList.add("is-invalid"),a.classList.remove("is-valid")},yearMonthDayToUTCString=(e,t,a)=>{e=("000"+e).slice(-4),t=("0"+t).slice(-2),a=("0"+a).slice(-2),e=new Date(e+`-${t}-${a}T00:00:00`),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},validate=()=>{var e=desfec.value.trim();return!isNaN(Date.parse(e))||(setError(desfec,"Fecha requerida"),setTimeout(function(){setSuccess(desfec)},3e3),!1)},estadosGantt=(e,o,t,i)=>{var a=new Date(t.desde),n=new Date(t.hasta);let s=new Array(i).fill(0),p=[],m=0,u=0,D=new Array;let h=0,C="";if(0!==e.length){e.map(e=>{var t=new Date(e.FECHA).getDate(),a=new Date(e.FECHA).getDay(),n=o[o.indexOf(e.FECHA)];if(m!=e.OFIUSU||u!=e.IDUSUA){if(u){D[h]=new Array,D[h][0]=C,D[h].push(p),h++;for(var d=0;d<i;d++)1!==p[d]&&10!==p[d]||s[d]++,-1===p[d]&&(s[d]="")}p=new Array(i).fill(1),u=e.IDUSUA,C=e.NOMUSU}m!=e.OFIUSU&&(m&&(D[h]=new Array,D[h][0]=0,D[h].push(s),h++,s=new Array(i).fill(0)),D[h]=new Array,D[h][0]=-1,D[h].push(e.DESOFI),h++,m=e.OFIUSU),p[t-1]=6===a||0===a||n?-1:Number(e.TIPEST)}),D[h]=new Array,D[h][0]=C,D[h].push(p),h++;for(var d=0;d<i;d++)1!==p[d]&&10!==p[d]||s[d]++,-1===p[d]&&(s[d]="");D[h]=new Array,D[h][0]=0,D[h].push(s);var g=document.getElementsByTagName("thead")[0];let l=document.getElementsByTagName("tbody")[0],c=document.createElement("tr"),r=document.createElement("tr");var v,y=document.createElement("tr"),f=null;(f=document.createElement("th")).style.cssText="border: none; text-align: center;",f.style.minWidth="250px",y.appendChild(f),g.appendChild(y);for(var E=a;E<=n;E.setDate(E.getDate()+1))v=document.createTextNode(("0"+E.getDate()).slice(-2)),(f=document.createElement("th")).appendChild(v),f.style.cssText="border: none; text-align: center",y.appendChild(f),g.appendChild(y);D.map(e=>{if(-1===e[0])c=document.createElement("tr"),n=document.createElement("td"),a=document.createTextNode(e[1]),n.appendChild(a),n.style.cssText="color: orangered; border: none; text-align: center;",n.style.minWidth="250px",c.appendChild(n),l.appendChild(c);else if(0===e[0]){c=document.createElement("tr"),n=document.createElement("td"),a=document.createTextNode("Personal en activo"),n.appendChild(a),n.style.cssText="color: blue; border: none; text-align: left;",c.appendChild(n);for(var t=0;t<i;t++){(n=document.createElement("td")).style.cssText="color: blue; border: none; text-align: center;";var a=document.createTextNode(e[1][t]);n.appendChild(a),c.appendChild(n)}l.appendChild(c)}else{r=document.createElement("tr"),n=document.createElement("td"),a=document.createTextNode(e[0]),n.appendChild(a),r.appendChild(n),l.appendChild(r);for(var n,d,t=0;t<i;t++)-1===e[1][t]||0===e[1][t]?((n=document.createElement("td")).style.background="#FAFAFA",r.appendChild(n)):1===e[1][t]?(n=document.createElement("td"),r.appendChild(n)):e[1][t]===tipos.vacacion.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("vacación"),n.className="timeline vacas",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.baja.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("baja"),n.className="timeline bajas",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.traspaso.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("traspaso"),n.className="timeline trasp",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.formacion.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("formación"),n.className="timeline forma",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.conciliacion.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("conciliación"),n.className="timeline conci",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.reunion.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("reunión"),n.className="timeline reuni",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.horas.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("horas"),n.className="timeline horas",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.telefono.ID?(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("teléfono"),n.className="timeline tele",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n)):e[1][t]===tipos.traspasado.ID&&(n=document.createElement("td"),d=document.createElement("div"),a=document.createTextNode("traspasado"),n.className="timeline trasdo",r.appendChild(n),d.className="popup",d.appendChild(a),n.appendChild(d),r.appendChild(n))}})}};desfec.addEventListener("change",function(e){var t=document.getElementById("cbofor").value,a=new Date(document.querySelector("#desfec").value).getFullYear(),n=new Date(document.querySelector("#desfec").value).getMonth()+1;let d=new Date(yearMonthDayToUTCString(a,n,1)),l=d;if("1"===t){t=new Date(a,n,0).getDate();l=new Date(yearMonthDayToUTCString(a,n,t))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),l=0===e.getDay()?(e.setDate(e.getDate()+1),d=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),d=new Date(new Date(document.querySelector("#desfec").value)),e):(a=e.getDate()-e.getDay(),e.setDate(d.getDate()+a),d=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=d.toISOString().slice(0,10),document.querySelector("#hasta").value=l.toISOString().slice(0,10)}),cbofor.addEventListener("change",function(e){var t=new Date(document.querySelector("#desfec").value).getFullYear(),a=new Date(document.querySelector("#desfec").value).getMonth()+1;let n=new Date(yearMonthDayToUTCString(t,a,1)),d=n;if("1"===e.target.value){e=new Date(t,a,0).getDate();d=new Date(yearMonthDayToUTCString(t,a,e))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),d=0===e.getDay()?(e.setDate(e.getDate()+1),n=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),n=new Date(new Date(document.querySelector("#desfec").value)),e):(t=e.getDate()-e.getDay(),e.setDate(n.getDate()+t),n=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=n.toISOString().slice(0,10),document.querySelector("#hasta").value=d.toISOString().slice(0,10)}),estadosGantt(estados,festivos,periodo,diasPeriodo);