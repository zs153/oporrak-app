/*! oporrak 2023-10-02 */
const desfec=document.getElementById("desfec"),cbofor=document.getElementById("cbofor"),setSuccess=e=>{var t=e.parentElement;t.querySelector(".invalid-feedback").innerText="",t.classList.add("is-valid"),e.classList.remove("is-invalid")},setError=(e,t)=>{var a=e.parentElement;a.querySelector(".invalid-feedback").innerText=t,e.classList.add("is-invalid"),a.classList.remove("is-valid")},yearMonthDayToUTCString=(e,t,a)=>{e=("000"+e).slice(-4),t=("0"+t).slice(-2),a=("0"+a).slice(-2),e=new Date(e+`-${t}-${a}T00:00:00`),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},validate=()=>{var e=desfec.value.trim();return!isNaN(Date.parse(e))||(setError(desfec,"Fecha requerida"),setTimeout(function(){setSuccess(desfec)},3e3),!1)},estadosGantt=(e,i,t,s)=>{var n=new Date(t.desde),d=new Date(t.hasta);let p=new Array(14*s).fill(0),m=[],u=0,h=0,D=new Array;let C=0,y="";if(0!==e.length){e.map(t=>{new Date(t.FECHA).getDate();var a=new Date(t.FECHA).getDay(),e=i[i.indexOf(t.FECHA)],n=t.DESHOR.split(":"),d=t.HASHOR.split(":"),n=2*(parseInt(n[0])-8)+(parseInt(n[1])<30?0:1),l=2*(parseInt(d[0])-8)+(parseInt(d[1])<30?0:1);if(u!=t.OFIUSU||h!=t.IDUSUA){if(h){D[C]=new Array,D[C][0]=y,D[C].push(m),C++;for(var o=0;o<14*s;o++)1!==m[o]&&10!==m[o]||p[o]++,-1===m[o]&&(p[o]="")}m=new Array(14*s).fill(1),h=t.IDUSUA,y=t.NOMUSU}if(u!=t.OFIUSU&&(u&&(D[C]=new Array,D[C][0]=0,D[C].push(p),C++,p=new Array(14*s).fill(0)),D[C]=new Array,D[C][0]=-1,D[C].push(t.DESOFI),C++,u=t.OFIUSU),6===a||0===a||e)for(let e=0;e<14;e++)m[14*(a-1)+e]=-1;else for(let e=n;e<l;e++)m[14*(a-1)+e]=Number(t.TIPEST)}),D[C]=new Array,D[C][0]=y,D[C].push(m),C++;for(var g=0;g<14*s;g++)1!==m[g]&&10!==m[g]||p[g]++,-1===m[g]&&(p[g]="");D[C]=new Array,D[C][0]=0,D[C].push(p);var f=document.getElementsByTagName("thead")[0];let l=document.getElementsByTagName("tbody")[0],o=document.createElement("tr"),c=document.createElement("tr");var v=document.createElement("tr");let t=document.createElement("tr"),r=null,a=null;(r=document.createElement("th")).style.cssText="border: none; text-align: center;",r.style.minWidth="250px",v.appendChild(r),f.appendChild(v);for(var x=n;x<=d;x.setDate(x.getDate()+1))a=document.createTextNode(("0"+x.getDate()).slice(-2)),(r=document.createElement("th")).appendChild(a),r.colSpan=14,r.style.cssText="border: none; text-align: center",v.appendChild(r),f.appendChild(v);a=document.createTextNode(""),(r=document.createElement("th")).appendChild(a),r.style.cssText="border: none; text-align: left",t.appendChild(r),f.appendChild(t);for(let e=0;e<s;e++)for(let e=8;e<=14;e++)a=document.createTextNode(("0"+e).slice(-2)),(r=document.createElement("th")).appendChild(a),r.colSpan=2,r.style.cssText="border: none; text-align: center",t.appendChild(r),f.appendChild(t);t=document.createElement("tr"),(r=document.createElement("th")).style.cssText="border: none;",t.appendChild(r),f.appendChild(t);for(let e=0;e<14*s;e++)a=e%2==0?document.createTextNode("00"):document.createTextNode("30"),(r=document.createElement("th")).appendChild(a),r.style.cssText="border: none; text-align: center; font-size: 8px;",r.style.minWidth="14px",t.appendChild(r),f.appendChild(t);D.map(t=>{if(-1===t[0])o=document.createElement("tr"),r=document.createElement("td"),n=document.createTextNode(t[1]),r.appendChild(n),r.style.cssText="color: orangered; border: none; text-align: center;",r.style.minWidth="250px",o.appendChild(r),l.appendChild(o);else if(0===t[0]){o=document.createElement("tr"),r=document.createElement("td"),n=document.createTextNode("Personal en activo"),r.appendChild(n),r.style.cssText="color: blue; border: none; text-align: left;",o.appendChild(r);for(let e=0;e<14*s;e++){var a=document.createElement("td");const n=document.createTextNode(t[1][e]);a.style.cssText="color:blue;border:none;text-align:center;",a.style.minWidth="14px",a.style.fontSize="10px",a.appendChild(n),o.appendChild(a)}l.appendChild(o)}else{c=document.createElement("tr"),(r=document.createElement("td")).style.borderRight="1px solid #9ba9be",n=document.createTextNode(t[0]),r.appendChild(n),c.appendChild(r),l.appendChild(c);for(var e,n,d=0;d<14*s;d++)(r=document.createElement("td")).style.minWidth="14px",(d+1)%14==0&&(r.style.borderRight="1px solid #9ba9be"),-1===t[1][d]||t[1][d]===tipos.festivo.ID?(r.style.background="#FAFAFA",c.appendChild(r)):t[1][d]===tipos.activo.ID?c.appendChild(r):t[1][d]===tipos.vacacion.ID?(n=document.createTextNode("vacación"),r.className="timeline vacas",c.appendChild(r),(e=document.createElement("div")).className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.baja.ID?(e=document.createElement("div"),n=document.createTextNode("baja"),r.className="timeline bajas",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.traspaso.ID?(e=document.createElement("div"),n=document.createTextNode("traspaso"),r.className="timeline trasp",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.formacion.ID?(e=document.createElement("div"),n=document.createTextNode("formación"),r.className="timeline forma",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.conciliacion.ID?(e=document.createElement("div"),n=document.createTextNode("conciliación"),r.className="timeline conci",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.reunion.ID?(e=document.createElement("div"),n=document.createTextNode("reunión"),r.className="timeline reuni",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.horas.ID?(e=document.createElement("div"),n=document.createTextNode("horas"),r.className="timeline horas",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.telefono.ID?(e=document.createElement("div"),n=document.createTextNode("teléfono"),r.className="timeline tele",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r)):t[1][d]===tipos.traspasado.ID&&(e=document.createElement("div"),n=document.createTextNode("traspasado"),r.className="timeline trasdo",c.appendChild(r),e.className="popup",e.appendChild(n),r.appendChild(e),c.appendChild(r))}})}};desfec.addEventListener("change",function(e){var t=document.getElementById("cbofor").value,a=new Date(document.querySelector("#desfec").value).getFullYear(),n=new Date(document.querySelector("#desfec").value).getMonth()+1;let d=new Date(yearMonthDayToUTCString(a,n,1)),l=d;if("1"===t){t=new Date(a,n,0).getDate();l=new Date(yearMonthDayToUTCString(a,n,t))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),l=0===e.getDay()?(e.setDate(e.getDate()+1),d=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),d=new Date(new Date(document.querySelector("#desfec").value)),e):(a=e.getDate()-e.getDay(),e.setDate(d.getDate()+a),d=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=d.toISOString().slice(0,10),document.querySelector("#hasta").value=l.toISOString().slice(0,10)}),cbofor.addEventListener("change",function(e){var t=new Date(document.querySelector("#desfec").value).getFullYear(),a=new Date(document.querySelector("#desfec").value).getMonth()+1;let n=new Date(yearMonthDayToUTCString(t,a,1)),d=n;if("1"===e.target.value){e=new Date(t,a,0).getDate();d=new Date(yearMonthDayToUTCString(t,a,e))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),d=0===e.getDay()?(e.setDate(e.getDate()+1),n=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),n=new Date(new Date(document.querySelector("#desfec").value)),e):(t=e.getDate()-e.getDay(),e.setDate(n.getDate()+t),n=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=n.toISOString().slice(0,10),document.querySelector("#hasta").value=d.toISOString().slice(0,10)}),estadosGantt(estados,festivos,periodo,diasPeriodo);