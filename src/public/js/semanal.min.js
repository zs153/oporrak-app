/*! oporrak 2023-05-18 */
const desfec=document.getElementById("desfec"),cbofor=document.getElementById("cbofor"),setSuccess=e=>{var t=e.parentElement;t.querySelector(".invalid-feedback").innerText="",t.classList.add("is-valid"),e.classList.remove("is-invalid")},setError=(e,t)=>{var a=e.parentElement;a.querySelector(".invalid-feedback").innerText=t,e.classList.add("is-invalid"),a.classList.remove("is-valid")},yearMonthDayToUTCString=(e,t,a)=>{e=("000"+e).slice(-4),t=("0"+t).slice(-2),a=("0"+a).slice(-2),e=new Date(e+`-${t}-${a}T00:00:00`),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},validate=()=>{var e=desfec.value.trim();return!isNaN(Date.parse(e))||(setError(desfec,"Fecha requerida"),setTimeout(function(){setSuccess(desfec)},3e3),!1)},estadosGantt=(e,r,t,i)=>{var a=new Date(t.desde),n=new Date(t.hasta);let s=new Array(14*i).fill(0),p=[],m=0,u=0,h=new Array;let D=0,C="";if(0!==e.length){e.map(t=>{new Date(t.FECHA).getDate();var a=new Date(t.FECHA).getDay(),e=r[r.indexOf(t.FECHA)],n=t.DESHOR.split(":"),d=t.HASHOR.split(":"),n=2*(parseInt(n[0])-8)+(parseInt(n[1])<30?0:1),l=2*(parseInt(d[0])-8)+(parseInt(d[1])<30?0:1);if(m!=t.OFIUSU||u!=t.IDUSUA){if(u){h[D]=new Array,h[D][0]=C,h[D].push(p),D++;for(var o=0;o<14*i;o++)1!==p[o]&&10!==p[o]||s[o]++,-1===p[o]&&(s[o]="")}p=new Array(14*i).fill(1),u=t.IDUSUA,C=t.NOMUSU}if(m!=t.OFIUSU&&(m&&(h[D]=new Array,h[D][0]=0,h[D].push(s),D++,s=new Array(14*i).fill(0)),h[D]=new Array,h[D][0]=-1,h[D].push(t.DESOFI),D++,m=t.OFIUSU),6===a||0===a||e)for(let e=n;e<l;e++)p[14*(a-1)+e]=-1;else for(let e=n;e<l;e++)p[14*(a-1)+e]=Number(t.TIPEST)}),h[D]=new Array,h[D][0]=C,h[D].push(p),D++;for(var d=0;d<14*i;d++)1!==p[d]&&10!==p[d]||s[d]++,-1===p[d]&&(s[d]="");h[D]=new Array,h[D][0]=0,h[D].push(s);var y=document.getElementsByTagName("thead")[0];let l=document.getElementsByTagName("tbody")[0],o=document.createElement("tr"),c=document.createElement("tr");var g=document.createElement("tr");let t=document.createElement("tr");var f=null,v=null;(f=document.createElement("th")).style.cssText="border: none; text-align: center;",f.style.minWidth="250px",g.appendChild(f),y.appendChild(g);for(var x=a;x<=n;x.setDate(x.getDate()+1))v=document.createTextNode(("0"+x.getDate()).slice(-2)),(f=document.createElement("th")).appendChild(v),f.colSpan=14,f.style.cssText="border: none; text-align: center",g.appendChild(f),y.appendChild(g);v=document.createTextNode(""),(f=document.createElement("th")).appendChild(v),f.style.cssText="border: none; text-align: left",t.appendChild(f),y.appendChild(t);for(let e=0;e<i;e++)for(let e=8;e<=14;e++)v=document.createTextNode(("0"+e).slice(-2)),(f=document.createElement("th")).appendChild(v),f.colSpan=2,f.style.cssText="border: none; text-align: center",t.appendChild(f),y.appendChild(t);t=document.createElement("tr"),(f=document.createElement("th")).style.cssText="border: none;",t.appendChild(f),y.appendChild(t);for(let e=0;e<14*i;e++)v=e%2==0?document.createTextNode("00"):document.createTextNode("30"),(f=document.createElement("th")).appendChild(v),f.style.cssText="border: none; text-align: center; font-size: 8px;",f.style.minWidth="14px",t.appendChild(f),y.appendChild(t);h.map(t=>{if(-1===t[0])o=document.createElement("tr"),f=document.createElement("td"),n=document.createTextNode(t[1]),f.appendChild(n),f.style.cssText="color: orangered; border: none; text-align: center;",f.style.minWidth="250px",o.appendChild(f),l.appendChild(o);else if(0===t[0]){o=document.createElement("tr"),f=document.createElement("td"),n=document.createTextNode("Personal en activo"),f.appendChild(n),f.style.cssText="color: blue; border: none; text-align: left;",o.appendChild(f);for(let e=0;e<14*i;e++){var a=document.createElement("td");const n=document.createTextNode(t[1][e]);a.style.cssText="color:blue;border:none;text-align:center;",a.style.minWidth="14px",a.style.fontSize="10px",a.appendChild(n),o.appendChild(a)}l.appendChild(o)}else{c=document.createElement("tr"),(f=document.createElement("td")).style.borderRight="1px solid #9ba9be",n=document.createTextNode(t[0]),f.appendChild(n),c.appendChild(f),l.appendChild(c);for(var e,n,d=0;d<14*i;d++)(f=document.createElement("td")).style.minWidth="14px",(d+1)%14==0&&(f.style.borderRight="1px solid #9ba9be"),-1===t[1][d]||t[1][d]===tipos.festivo.ID?(f.style.background="#FAFAFA",c.appendChild(f)):t[1][d]===tipos.activo.ID?c.appendChild(f):t[1][d]===tipos.vacacion.ID?(n=document.createTextNode("vacación"),f.className="timeline vacas",c.appendChild(f),(e=document.createElement("div")).className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.baja.ID?(e=document.createElement("div"),n=document.createTextNode("baja"),f.className="timeline bajas",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.traspaso.ID?(e=document.createElement("div"),n=document.createTextNode("traspaso"),f.className="timeline trasp",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.formacion.ID?(e=document.createElement("div"),n=document.createTextNode("formación"),f.className="timeline forma",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.conciliacion.ID?(e=document.createElement("div"),n=document.createTextNode("conciliación"),f.className="timeline conci",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.reunion.ID?(e=document.createElement("div"),n=document.createTextNode("reunión"),f.className="timeline reuni",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.horas.ID?(e=document.createElement("div"),n=document.createTextNode("horas"),f.className="timeline horas",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.telefono.ID?(e=document.createElement("div"),n=document.createTextNode("teléfono"),f.className="timeline tele",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f)):t[1][d]===tipos.traspasado.ID&&(e=document.createElement("div"),n=document.createTextNode("traspasado"),f.className="timeline trasdo",c.appendChild(f),e.className="popup",e.appendChild(n),f.appendChild(e),c.appendChild(f))}})}};desfec.addEventListener("change",function(e){var t=document.getElementById("cbofor").value,a=new Date(document.querySelector("#desfec").value).getFullYear(),n=new Date(document.querySelector("#desfec").value).getMonth()+1;let d=new Date(yearMonthDayToUTCString(a,n,1)),l=d;if("1"===t){t=new Date(a,n,0).getDate();l=new Date(yearMonthDayToUTCString(a,n,t))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),l=0===e.getDay()?(e.setDate(e.getDate()+1),d=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),d=new Date(new Date(document.querySelector("#desfec").value)),e):(a=e.getDate()-e.getDay(),e.setDate(d.getDate()+a),d=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=d.toISOString().slice(0,10),document.querySelector("#hasta").value=l.toISOString().slice(0,10)}),cbofor.addEventListener("change",function(e){var t=new Date(document.querySelector("#desfec").value).getFullYear(),a=new Date(document.querySelector("#desfec").value).getMonth()+1;let n=new Date(yearMonthDayToUTCString(t,a,1)),d=n;if("1"===e.target.value){e=new Date(t,a,0).getDate();d=new Date(yearMonthDayToUTCString(t,a,e))}else{let e=new Date;e=new Date(document.querySelector("#desfec").value),d=0===e.getDay()?(e.setDate(e.getDate()+1),n=new Date(e),new Date(e.setDate(e.getDate()+4))):1===e.getDay()?((e=new Date(new Date(document.querySelector("#desfec").value))).setDate(e.getDate()+4),n=new Date(new Date(document.querySelector("#desfec").value)),e):(t=e.getDate()-e.getDay(),e.setDate(n.getDate()+t),n=new Date(e),new Date(e.setDate(e.getDate()+4)))}document.querySelector("#desde").value=n.toISOString().slice(0,10),document.querySelector("#hasta").value=d.toISOString().slice(0,10)}),estadosGantt(estados,festivos,periodo,diasPeriodo);