/*! oporrak 2023-05-16 */
const getCookie=t=>{let a="";return document.cookie.split(";").forEach(e=>{e.includes(t)&&(a=e.split("=")[1])}),a},setCookie=(e,t,a)=>{let n="";var o;a&&((o=new Date).setTime(o.getTime()+24*a*60*60*1e3),n="; expires="+o.toUTCString()),document.cookie=e+"="+(t||"")+n+"; path=/"},deleteCookie=()=>{document.cookie="filtro=; expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/;"},dateISOToUTCString=e=>{var e=new Date(e),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},elemUpdate=document.getElementById("upd");elemUpdate.setAttribute("action","/admin/festivos/update?part="+getCookie("filtro"));let eventos=[],calendario=null,currentYear=(new Date).getFullYear(),params={color:"<%- datos.tiposEstado.festivo.COLOR %>",desde:dateISOToUTCString(currentYear+"-01-01T00:00:00"),hasta:dateISOToUTCString(currentYear+"-12-31T00:00:00")};(calendario=new Calendar("#calendar",{minDate:new Date(params.desde),maxDate:new Date(params.hasta),language:"es",displayHeader:!1,customDayRenderer:function(e,t){0===t.getDay()&&(e.style.color=params.color)},dataSource:function(){return dataSource.map(e=>({idfest:e.idfest,ofifes:e.ofifes,startDate:new Date(e.fecfes),endDate:new Date(e.fecfes),color:e.color}))}})).setYear(currentYear),document.getElementById("btnUpdate").addEventListener("click",()=>{document.getElementById("eventos").value=JSON.stringify(eventos)}),document.getElementById("cboyea").addEventListener("change",function(){currentYear=parseInt(document.querySelector("#cboyea").value),params.desde=dateISOToUTCString(currentYear+"-01-01T00:00:00"),params.hasta=dateISOToUTCString(currentYear+"-12-31T00:00:00"),calendario.setMinDate(new Date(params.desde)),calendario.setMaxDate(new Date(params.hasta)),calendario.setYear(currentYear)}),document.getElementById("calendar").addEventListener("clickDay",async function(e){if(!e.element.classList.contains("domingo")){var a=dateISOToUTCString(e.date);if(e.events.length){e.events[0].idfest<0?(n=eventos.map(e=>e.idfest).indexOf(a),eventos.splice(n,1)):eventos.push({idfest:e.events[0].idfest,fecfes:"",ofifes:0}),pos=dataSource.map(e=>e.fecfes).indexOf(a),dataSource.splice(pos,1);let t=[];dataSource.map(e=>{t.push({idfest:e.idfest,ofifes:e.ofifes,startDate:new Date(e.startDate),endDate:new Date(e.endDate),color:e.color})}),calendario.setDataSource(t,{preventRendering:!1}),e.element.attributes.removeNamedItem("style")}else{var n=-Date.now();dataSource.push({idfest:n,ofifes:oficina.IDOFIC,startDate:a,endDate:a,color:params.color}),eventos.push({idfest:n,fecfes:a,ofifes:oficina.IDOFIC});let t=[];dataSource.map(e=>{t.push({idfest:e.idfest,ofifes:e.ofifes,startDate:new Date(e.startDate),endDate:new Date(e.endDate),color:e.color})}),calendario.setDataSource(t,{preventRendering:!1}),e.element.style.boxShadow=params.color+" 0px -4px 0px 0px inset"}}});