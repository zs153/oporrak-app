/*! oporrak 2023-05-13 */
import axios from"axios";import{serverAPI,puertoAPI}from"../../config/settings";import{estadosMatricula,tiposMovimiento}from"../../public/js/enumeraciones";const matriculasPage=async(r,s)=>{r=r.user;try{var a={matriculas:(await axios.post(`http://${serverAPI}:${puertoAPI}/api/formacion/matricula`,{context:{IDUSUA:r.id,STAMAT:estadosMatricula.abierta}})).data.data};s.render("user/formacion/matriculas",{user:r,datos:a})}catch(r){400===r.response?.status?s.render("user/error400",{alerts:[{msg:r.response.data.msg}]}):s.render("user/error500",{alerts:[{msg:r}]})}},cursosPage=async(r,s)=>{var a=r.user;try{var e={cursos:(await axios.post(`http://${serverAPI}:${puertoAPI}/api/formacion/curso`,{context:{IDUSUA:r.user.id}})).data.data};s.render("user/formacion/cursos",{user:a,datos:e})}catch(r){400===r.response?.status?s.render("user/error400",{alerts:[{msg:r.response.data.msg}]}):s.render("user/error500",{alerts:[{msg:r.response.data.msg}]})}},quieroMatricularme=async(r,s)=>{var a=r.user,e={IDMATR:r.body.idmatr},r={ARRUSU:[parseInt(r.body.idusua)]},a={USUMOV:a.id,TIPMOV:tiposMovimiento.insertarUsuarioMatricula};try{await axios.post(`http://${serverAPI}:${puertoAPI}/api/cursos/matriculas/usuarios/insert`,{matricula:e,usuarios:r,movimiento:a}),s.redirect("/user/formacion/matriculas")}catch(r){400===r.response?.status?s.render("user/error400",{alerts:[{msg:r.response.data.msg}]}):s.render("user/error500",{alerts:[{msg:r}]})}};export{matriculasPage,cursosPage,quieroMatricularme};