/*! oporrak 2023-05-16 */
import axios from"axios";import{serverAPI,puertoAPI}from"../../config/settings";import{tiposRol,tiposEstado,arrTiposPerfil}from"../../public/js/enumeraciones";const mainPage=async(e,t)=>{var e=e.user,a=(new Date).getFullYear(),r=(new Date).getMonth()+1,s=new Date(a,r,0).getDate(),o=yearMonthDayToUTCString(a,r,1),a=yearMonthDayToUTCString(a,r,s);try{var i={oficinas:(await axios.post(`http://${serverAPI}:${puertoAPI}/api/oficina`,{context:{}})).data.data,arrTiposPerfil:arrTiposPerfil,desde:o,hasta:a};t.render("user/estados",{user:e,datos:i})}catch(e){400===e.response?.status?t.render("user/error400",{alerts:[{msg:e.response.data.msg}]}):t.render("user/error500",{alerts:[{msg:e}]})}},estadosPage=async(e,t)=>{var a=e.user,r={DESDE:e.body.desde,HASTA:e.body.hasta},s=e.body.desofi,o=e.body.desper,i=Math.ceil(Date.parse(r.HASTA)-Date.parse(r.DESDE))/864e5+1,n={PERUSU:e.body.perusu,DESDE:r.DESDE,HASTA:r.HASTA};"0"!==e.body.ofiest&&(n.OFIEST=e.body.ofiest);try{var d=await axios.post(`http://${serverAPI}:${puertoAPI}/api/oficina`,{context:{}}),p=await axios.post(`http://${serverAPI}:${puertoAPI}/api/festivos/oficinas`,{context:{OFIFES:e.body.ofiest,DESDE:r.DESDE,HASTA:r.HASTA}}),c=await axios.post(`http://${serverAPI}:${puertoAPI}/api/estados/oficinas/perfiles`,{context:n}),D={oficinas:d.data.data,estados:c.data.data,festivos:p.data.data.map(e=>e.FECFES),tiposEstado:tiposEstado,tiposRol:tiposRol,arrTiposPerfil:arrTiposPerfil,periodo:r,diasPeriodo:i,strDesde:new Date(r.DESDE).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}),strHasta:new Date(r.HASTA).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}),descripcionOficina:s,descripcionPerfil:o};"1"===e.body.format?t.render("user/estados/mensual",{user:a,datos:D}):t.render("user/estados/semanal",{user:a,datos:D})}catch(e){400===e.response?.status?t.render("user/error400",{alerts:[{msg:e.response.data.msg}]}):t.render("user/error500",{alerts:[{msg:e}]})}},dateISOToUTCString=e=>{var e=new Date(e),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},yearMonthDayToUTCString=(e,t,a)=>{e=("000"+e).slice(-4),t=("0"+t).slice(-2),a=("0"+a).slice(-2),e=new Date(e+`-${t}-${a}T00:00:00`),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)};export{mainPage,estadosPage};