/*! oporrak 2023-05-18 */
import axios from"axios";import{serverAPI,puertoAPI}from"../../config/settings";import{tiposRol,tiposEstado,arrTiposPerfil,arrTiposFormato,tiposFormato}from"../../public/js/enumeraciones";const mainPage=async(e,t)=>{var e=e.user,a=(new Date).getFullYear(),r=(new Date).getMonth()+1,o=new Date(a,r,0).getDate(),s=yearMonthDayToUTCString(a,r,1),a=yearMonthDayToUTCString(a,r,o);try{var i={oficinas:(await axios.post(`http://${serverAPI}:${puertoAPI}/api/oficina`,{context:{}})).data.data,arrTiposPerfil:arrTiposPerfil,arrTiposFormato:arrTiposFormato,formato:tiposFormato.mensual,desde:s,hasta:a};t.render("user/estados",{user:e,datos:i})}catch(e){400===e.response?.status?t.render("user/error400",{alerts:[{msg:e.response.data.msg}]}):t.render("user/error500",{alerts:[{msg:e}]})}},estadosPage=async(e,t)=>{var a=e.user,r={DESDE:e.body.desde,HASTA:e.body.hasta},o=e.body.format,s=e.body.desofi,i=e.body.desper,n=Math.ceil(Date.parse(r.HASTA)-Date.parse(r.DESDE))/864e5+1,d={PERUSU:e.body.perusu,DESDE:r.DESDE,HASTA:r.HASTA};"0"!==e.body.ofiest&&(d.OFIEST=e.body.ofiest);try{var p=await axios.post(`http://${serverAPI}:${puertoAPI}/api/oficina`,{context:{}}),m=await axios.post(`http://${serverAPI}:${puertoAPI}/api/festivos/oficinas`,{context:{OFIFES:e.body.ofiest,DESDE:r.DESDE,HASTA:r.HASTA}}),c=await axios.post(`http://${serverAPI}:${puertoAPI}/api/estados/oficinas/perfiles`,{context:d}),f={oficinas:p.data.data,estados:c.data.data,festivos:m.data.data.map(e=>e.FECFES),tiposEstado:tiposEstado,tiposRol:tiposRol,arrTiposPerfil:arrTiposPerfil,arrTiposFormato:arrTiposFormato,periodo:r,diasPeriodo:n,formato:o,strDesde:new Date(r.DESDE).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}),strHasta:new Date(r.HASTA).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}),descripcionOficina:s,descripcionPerfil:i};console.log(f.formato),"1"===e.body.format?t.render("user/estados/mensual",{user:a,datos:f}):t.render("user/estados/semanal",{user:a,datos:f})}catch(e){400===e.response?.status?t.render("user/error400",{alerts:[{msg:e.response.data.msg}]}):t.render("user/error500",{alerts:[{msg:e}]})}},dateISOToUTCString=e=>{var e=new Date(e),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)},yearMonthDayToUTCString=(e,t,a)=>{e=("000"+e).slice(-4),t=("0"+t).slice(-2),a=("0"+a).slice(-2),e=new Date(e+`-${t}-${a}T00:00:00`),t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)};export{mainPage,estadosPage};